{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Documenta\u00e7\u00e3o Aqui voc\u00ea pode encontrar informa\u00e7\u00f5es sobre a infraestrutura geral de Monitoramento da secretaria e tamb\u00e9m metodologias de sistemas espec\u00edficos desenvolvidos pela equipe. Utilize o menu \u00e0 esquerda para nagevar na documenta\u00e7\u00e3o da SMTR.","title":"In\u00edcio"},{"location":"#documentacao","text":"Aqui voc\u00ea pode encontrar informa\u00e7\u00f5es sobre a infraestrutura geral de Monitoramento da secretaria e tamb\u00e9m metodologias de sistemas espec\u00edficos desenvolvidos pela equipe. Utilize o menu \u00e0 esquerda para nagevar na documenta\u00e7\u00e3o da SMTR.","title":"Documenta\u00e7\u00e3o"},{"location":"infra/","text":"Infraestrutura da SMTR Vis\u00e3o geral A infraestrutura da SMTR \u00e9 constru\u00edda em cima do Google BigQuery. Os projetos est\u00e3o divididos em: dev : ambiente de teste; staging : tabelas de staging do Base dos Dados no BigQuery prod : tabelas finais para consumo de outras \u00e1reas e aplica\u00e7\u00f5es. Todo c\u00f3digo das pipelinas de captura e/ou atualiza\u00e7\u00e3o das tabelas em desenvolvimento e produ\u00e7\u00e3o est\u00e3o versionados no Github . Datalake Vis\u00e3o geral Dagster/Maestro: Orquestrador de pipelines de captura e atualiza\u00e7\u00e3o de dados. Gerenciamento de queries (maestro-bq) Qualquer erro na pipeline \u00e9 avisado no Discord Pipelines Lista das pipelines implementadas Fluxo de dados (dag)","title":"In\u00edcio"},{"location":"infra/#infraestrutura-da-smtr","text":"","title":"Infraestrutura da SMTR"},{"location":"infra/#visao-geral","text":"A infraestrutura da SMTR \u00e9 constru\u00edda em cima do Google BigQuery. Os projetos est\u00e3o divididos em: dev : ambiente de teste; staging : tabelas de staging do Base dos Dados no BigQuery prod : tabelas finais para consumo de outras \u00e1reas e aplica\u00e7\u00f5es. Todo c\u00f3digo das pipelinas de captura e/ou atualiza\u00e7\u00e3o das tabelas em desenvolvimento e produ\u00e7\u00e3o est\u00e3o versionados no Github .","title":"Vis\u00e3o geral"},{"location":"infra/#datalake","text":"","title":"Datalake"},{"location":"infra/#visao-geral_1","text":"Dagster/Maestro: Orquestrador de pipelines de captura e atualiza\u00e7\u00e3o de dados. Gerenciamento de queries (maestro-bq) Qualquer erro na pipeline \u00e9 avisado no Discord","title":"Vis\u00e3o geral"},{"location":"infra/#pipelines","text":"Lista das pipelines implementadas Fluxo de dados (dag)","title":"Pipelines"},{"location":"infra/maestro-bq/","text":"maestro-bq Sistema de controle, versionamento e documenta\u00e7\u00e3o de queries do BigQuery usando o Maestro como orquestrador. Atributos dispon\u00edveis para queries run_key : a chave montada no Dagster para essa execu\u00e7\u00e3o run_timestamp : estampa de tempo dessa execu\u00e7\u00e3o (exclusivo para cada execu\u00e7\u00e3o de pipeline) maestro_sha : hash do commit mais recente na branch default do reposit\u00f3rio maestro maestro_bq_sha : hash do commit mais recente na branch default do reposit\u00f3rio maestro-bq date_range_start : in\u00edcio da janela de filtragem para backfill Coincide com o backfill.start_timestamp do YAML na cria\u00e7\u00e3o da tabela Coincide com o timestamp da \u00faltima execu\u00e7\u00e3o nas outras execu\u00e7\u00f5es date_range_end : fim da janela de filtragem para backfill Coincide com o timestamp do sensor (\u00fanico para todas as RunRequests daquela execu\u00e7\u00e3o do sensor) Tudo que estiver dentro da chave parameters do YAML, sem o prefixo parameters.* Exemplo: no YAML -> parameters.interval = 2 , na query -> {{ interval }} Exemplo de materialized view Arquivo de query em maestro-bq/materialized_views/br_rj_riodejaneiro_brt_gps/materialized_registros_tratada.sql : WITH box AS ( SELECT * FROM ` rj - smtr . br_rj_riodejaneiro_geo . limites_geograficos_caixa ` ) SELECT * , {{ run_key }} AS run_key , {{ run_timestamp }} AS run_timestamp , {{ maestro_sha }} AS maestro_sha , {{ maestro_bq_sha }} AS maestro_bq_sha , FROM ` rj - smtr . br_rj_riodejaneiro_brt_gps . registros ` WHERE DATETIME_DIFF ( timestamp_captura , timestamp_gps , MINUTE ) < {{ interval }} AND timestamp_gps >= {{ date_range_start }} AND timestamp_gps < {{ date_range_end }} AND longitude BETWEEN ( SELECT min_longitude FROM box ) AND ( SELECT max_longitude FROM box ) AND latitude BETWEEN ( SELECT min_latitude FROM box ) AND ( SELECT max_latitude FROM box ) Arquivo de configura\u00e7\u00e3o em maestro-bq/materialized_views/br_rj_riodejaneiro_brt_gps/materialized_registros_tratada.yaml : # Defini\u00e7\u00e3o de taxa de atualiza\u00e7\u00e3o scheduling : cron : \"0/5 * * * *\" # Defini\u00e7\u00e3o de particionamento # - column: nome da coluna # - type: deve ser um dos seguintes # * DATE (n\u00e3o exige per\u00edodo) # * DATE_TRUNC (exige per\u00edodo MONTH/YEAR) # * DATETIME_TRUNC (exige per\u00edodo DAY/HOUR/MONTH/YEAR) # * TIMESTAMP_TRUNC (exige per\u00edodo DAY/HOUR/MONTH/YEAR) # * <To-do> RANGE_BUCKET # * <To-do> GENERATE_ARRAY # - period: per\u00edodo (conforme especificado acima) partitioning : column : \"timestamp_gps\" type : \"DATE\" period : \"\" # Par\u00e2metros da query parameters : interval : 2 # Par\u00e2metros de backfill backfill : # Formato %Y-%m-%d %H:%M:%S start_timestamp : \"2021-01-01 00:00:00\" Resultado: cria\u00e7\u00e3o da tabela br_rj_riodejaneiro_brt_gps.materialized_registros_tratada que se materializa incrementalmente a cada 5 minutos e particionada diariamente em timestamp_gps","title":"Maestro-bq (Versionamento de queries)"},{"location":"infra/maestro-bq/#maestro-bq","text":"Sistema de controle, versionamento e documenta\u00e7\u00e3o de queries do BigQuery usando o Maestro como orquestrador.","title":"maestro-bq"},{"location":"infra/maestro-bq/#atributos-disponiveis-para-queries","text":"run_key : a chave montada no Dagster para essa execu\u00e7\u00e3o run_timestamp : estampa de tempo dessa execu\u00e7\u00e3o (exclusivo para cada execu\u00e7\u00e3o de pipeline) maestro_sha : hash do commit mais recente na branch default do reposit\u00f3rio maestro maestro_bq_sha : hash do commit mais recente na branch default do reposit\u00f3rio maestro-bq date_range_start : in\u00edcio da janela de filtragem para backfill Coincide com o backfill.start_timestamp do YAML na cria\u00e7\u00e3o da tabela Coincide com o timestamp da \u00faltima execu\u00e7\u00e3o nas outras execu\u00e7\u00f5es date_range_end : fim da janela de filtragem para backfill Coincide com o timestamp do sensor (\u00fanico para todas as RunRequests daquela execu\u00e7\u00e3o do sensor) Tudo que estiver dentro da chave parameters do YAML, sem o prefixo parameters.* Exemplo: no YAML -> parameters.interval = 2 , na query -> {{ interval }}","title":"Atributos dispon\u00edveis para queries"},{"location":"infra/maestro-bq/#exemplo-de-materialized-view","text":"Arquivo de query em maestro-bq/materialized_views/br_rj_riodejaneiro_brt_gps/materialized_registros_tratada.sql : WITH box AS ( SELECT * FROM ` rj - smtr . br_rj_riodejaneiro_geo . limites_geograficos_caixa ` ) SELECT * , {{ run_key }} AS run_key , {{ run_timestamp }} AS run_timestamp , {{ maestro_sha }} AS maestro_sha , {{ maestro_bq_sha }} AS maestro_bq_sha , FROM ` rj - smtr . br_rj_riodejaneiro_brt_gps . registros ` WHERE DATETIME_DIFF ( timestamp_captura , timestamp_gps , MINUTE ) < {{ interval }} AND timestamp_gps >= {{ date_range_start }} AND timestamp_gps < {{ date_range_end }} AND longitude BETWEEN ( SELECT min_longitude FROM box ) AND ( SELECT max_longitude FROM box ) AND latitude BETWEEN ( SELECT min_latitude FROM box ) AND ( SELECT max_latitude FROM box ) Arquivo de configura\u00e7\u00e3o em maestro-bq/materialized_views/br_rj_riodejaneiro_brt_gps/materialized_registros_tratada.yaml : # Defini\u00e7\u00e3o de taxa de atualiza\u00e7\u00e3o scheduling : cron : \"0/5 * * * *\" # Defini\u00e7\u00e3o de particionamento # - column: nome da coluna # - type: deve ser um dos seguintes # * DATE (n\u00e3o exige per\u00edodo) # * DATE_TRUNC (exige per\u00edodo MONTH/YEAR) # * DATETIME_TRUNC (exige per\u00edodo DAY/HOUR/MONTH/YEAR) # * TIMESTAMP_TRUNC (exige per\u00edodo DAY/HOUR/MONTH/YEAR) # * <To-do> RANGE_BUCKET # * <To-do> GENERATE_ARRAY # - period: per\u00edodo (conforme especificado acima) partitioning : column : \"timestamp_gps\" type : \"DATE\" period : \"\" # Par\u00e2metros da query parameters : interval : 2 # Par\u00e2metros de backfill backfill : # Formato %Y-%m-%d %H:%M:%S start_timestamp : \"2021-01-01 00:00:00\" Resultado: cria\u00e7\u00e3o da tabela br_rj_riodejaneiro_brt_gps.materialized_registros_tratada que se materializa incrementalmente a cada 5 minutos e particionada diariamente em timestamp_gps","title":"Exemplo de materialized view"},{"location":"infra/maestro/","text":"Maestro Maestro \u00e9 o nome dado a nosso orquestrador de pipelines de captura e atualiza\u00e7\u00e3o de dados . O Maestro \u00e9 constru\u00eddo com o software Dagster e \u00e9 executado em ambiente Docker . Instala\u00e7\u00e3o Requisitos Docker Python >= 3.8 (outras vers\u00f5es n\u00e3o s\u00e3o testadas) Pr\u00e9-configura\u00e7\u00e3o Clone o reposit\u00f3rio oficial do Maestro: git clone https://github.com/RJ-SMTR/maestro && cd maestro/ Crie um ambiente virtual e instale o maestro: # cria ambiente python -m venv .maestro # ativa ambiente . .maestro/bin/activate # instala maestro pip3 install -e . Prepare um arquivo com vari\u00e1veis de ambiente chamado .env_local . Ele deve seguir o seguinte modelo (preencher somente onde \u00e9 requisitado): MODE=dev DAGSTER_POSTGRES_USER=postgres DAGSTER_POSTGRES_PASSWORD=123456 DAGSTER_POSTGRES_HOST=localhost DAGSTER_POSTGRES_DB=postgres REDIS_HOST=localhost BQ_PROJECT_NAME=rj-smtr-dev SENSOR_BUCKET=rj-smtr-dev BASEDOSDADOS_CONFIG=<preencher> BASEDOSDADOS_CREDENTIALS_PROD=<preencher> BASEDOSDADOS_CREDENTIALS_STAGING=<preencher> DAGSTER_HOME=<preencher> Preencha DAGSTER_HOME com o caminho do reposit\u00f3rio do maestro + .dagster_workspace . Exemplo: /home/user/git_repos/maestro/.dagster_workspace Preencha BASEDOSDADOS_CONFIG com o resultado de cat $HOME/.basedosdados/config.toml | base64 , considerando que voc\u00ea possui as credenciais de DEV Preencha BASEDOSDADOS_CREDENTIALS_PROD e BASEDOSDADOS_CREDENTIALS_STAGING com o resultado de cat .basedosdados/credentials/prod.json | base64 , considerando que voc\u00ea possui as credenciais de DEV Ligando os servi\u00e7os Configurando o Docker Caso esteja rodando pela primeira vez ou tenha adicionado uma nova depend\u00eancia , execute a configura\u00e7\u00e3o do Dagster com: # ativando o ambiente (se n\u00e3o estiver ativo) . .maestro/bin/activate # configurando o maestro maestro setup Este comando instala as depend\u00eancias, configura o container (Docker) no qual o Dagster ficar\u00e1 ativo e indica qual host deve ser usado (neste caso, o localhost ). Ativando o Maestro Para ativar o Maestro, execute o comando: # ativando o ambiente (se n\u00e3o estiver ativo) . .maestro/bin/activate # rodando o maestro maestro up Com isso, o Dagit ficar\u00e1 dispon\u00edvel em http://localhost:3000/ . Os logs do daemon, dagit e gRPC ser\u00e3o todos redirecionados ao mesmo terminal. Desativando Para desativar o Maestro, basta fechar seu terminal (Ctrl+C). Caso queira remover as imagens criadas no Docker (por espa\u00e7o ou necessidade de uso das respectivas portas), rode: # removendo imagens Docker do maestro maestro down Aten\u00e7\u00e3o! Uma vez removidas as imagens, \u00e9 necess\u00e1rio configurar novamente o Docker antes ativar o Dagster, rodando: maestro setup maestro up","title":"Maestro (Orquestrador)"},{"location":"infra/maestro/#maestro","text":"Maestro \u00e9 o nome dado a nosso orquestrador de pipelines de captura e atualiza\u00e7\u00e3o de dados . O Maestro \u00e9 constru\u00eddo com o software Dagster e \u00e9 executado em ambiente Docker .","title":"Maestro"},{"location":"infra/maestro/#instalacao","text":"","title":"Instala\u00e7\u00e3o"},{"location":"infra/maestro/#requisitos","text":"Docker Python >= 3.8 (outras vers\u00f5es n\u00e3o s\u00e3o testadas)","title":"Requisitos"},{"location":"infra/maestro/#pre-configuracao","text":"Clone o reposit\u00f3rio oficial do Maestro: git clone https://github.com/RJ-SMTR/maestro && cd maestro/ Crie um ambiente virtual e instale o maestro: # cria ambiente python -m venv .maestro # ativa ambiente . .maestro/bin/activate # instala maestro pip3 install -e . Prepare um arquivo com vari\u00e1veis de ambiente chamado .env_local . Ele deve seguir o seguinte modelo (preencher somente onde \u00e9 requisitado): MODE=dev DAGSTER_POSTGRES_USER=postgres DAGSTER_POSTGRES_PASSWORD=123456 DAGSTER_POSTGRES_HOST=localhost DAGSTER_POSTGRES_DB=postgres REDIS_HOST=localhost BQ_PROJECT_NAME=rj-smtr-dev SENSOR_BUCKET=rj-smtr-dev BASEDOSDADOS_CONFIG=<preencher> BASEDOSDADOS_CREDENTIALS_PROD=<preencher> BASEDOSDADOS_CREDENTIALS_STAGING=<preencher> DAGSTER_HOME=<preencher> Preencha DAGSTER_HOME com o caminho do reposit\u00f3rio do maestro + .dagster_workspace . Exemplo: /home/user/git_repos/maestro/.dagster_workspace Preencha BASEDOSDADOS_CONFIG com o resultado de cat $HOME/.basedosdados/config.toml | base64 , considerando que voc\u00ea possui as credenciais de DEV Preencha BASEDOSDADOS_CREDENTIALS_PROD e BASEDOSDADOS_CREDENTIALS_STAGING com o resultado de cat .basedosdados/credentials/prod.json | base64 , considerando que voc\u00ea possui as credenciais de DEV","title":"Pr\u00e9-configura\u00e7\u00e3o"},{"location":"infra/maestro/#ligando-os-servicos","text":"","title":"Ligando os servi\u00e7os"},{"location":"infra/maestro/#configurando-o-docker","text":"Caso esteja rodando pela primeira vez ou tenha adicionado uma nova depend\u00eancia , execute a configura\u00e7\u00e3o do Dagster com: # ativando o ambiente (se n\u00e3o estiver ativo) . .maestro/bin/activate # configurando o maestro maestro setup Este comando instala as depend\u00eancias, configura o container (Docker) no qual o Dagster ficar\u00e1 ativo e indica qual host deve ser usado (neste caso, o localhost ).","title":"Configurando o Docker"},{"location":"infra/maestro/#ativando-o-maestro","text":"Para ativar o Maestro, execute o comando: # ativando o ambiente (se n\u00e3o estiver ativo) . .maestro/bin/activate # rodando o maestro maestro up Com isso, o Dagit ficar\u00e1 dispon\u00edvel em http://localhost:3000/ . Os logs do daemon, dagit e gRPC ser\u00e3o todos redirecionados ao mesmo terminal.","title":"Ativando o Maestro"},{"location":"infra/maestro/#desativando","text":"Para desativar o Maestro, basta fechar seu terminal (Ctrl+C). Caso queira remover as imagens criadas no Docker (por espa\u00e7o ou necessidade de uso das respectivas portas), rode: # removendo imagens Docker do maestro maestro down Aten\u00e7\u00e3o! Uma vez removidas as imagens, \u00e9 necess\u00e1rio configurar novamente o Docker antes ativar o Dagster, rodando: maestro setup maestro up","title":"Desativando"},{"location":"infra/multas-automaticas/","text":"Multas Autom\u00e1ticas - Pipeline Vis\u00e3o geral O sistema utiliza dados de opera\u00e7\u00e3o de ve\u00edculos via GPS (SPPO) e dados de planejamento das linhas via SIGMOB, combinados \u00e0s regras definidas na metodologia , para gerar o registro das multas dos cons\u00f3rcios. Todo dia \u00e0s 21h os dados s\u00e3o atualizados. Tabelas de an\u00e1lise tabela descri\u00e7\u00e3o sumario_multa_linha_onibus Consolida as infra\u00e7\u00f5es pass\u00edveis de multa por linha e hor\u00e1rio de pico (manh\u00e3/tarde). detalhes_linha_onibus_completa Detalha informa\u00e7\u00f5es de frota aferida e m\u00ednima por linha, indicadores de infra\u00e7\u00f5es cometidas e falhas de captura por faixa hor\u00e1ria. detalhes_multa_veiculo_onibus Detalha todos os registros de infra\u00e7\u00f5es por linha, faixa hor\u00e1ria e situa\u00e7\u00e3o da opera\u00e7\u00e3o (operando/garagem).","title":"Multas Autom\u00e1ticas"},{"location":"infra/multas-automaticas/#multas-automaticas-pipeline","text":"","title":"Multas Autom\u00e1ticas - Pipeline"},{"location":"infra/multas-automaticas/#visao-geral","text":"O sistema utiliza dados de opera\u00e7\u00e3o de ve\u00edculos via GPS (SPPO) e dados de planejamento das linhas via SIGMOB, combinados \u00e0s regras definidas na metodologia , para gerar o registro das multas dos cons\u00f3rcios. Todo dia \u00e0s 21h os dados s\u00e3o atualizados.","title":"Vis\u00e3o geral"},{"location":"infra/multas-automaticas/#tabelas-de-analise","text":"tabela descri\u00e7\u00e3o sumario_multa_linha_onibus Consolida as infra\u00e7\u00f5es pass\u00edveis de multa por linha e hor\u00e1rio de pico (manh\u00e3/tarde). detalhes_linha_onibus_completa Detalha informa\u00e7\u00f5es de frota aferida e m\u00ednima por linha, indicadores de infra\u00e7\u00f5es cometidas e falhas de captura por faixa hor\u00e1ria. detalhes_multa_veiculo_onibus Detalha todos os registros de infra\u00e7\u00f5es por linha, faixa hor\u00e1ria e situa\u00e7\u00e3o da opera\u00e7\u00e3o (operando/garagem).","title":"Tabelas de an\u00e1lise"},{"location":"pipelines/multas-automaticas/","text":"Multas Autom\u00e1ticas - Metodologia Vers\u00e3o: v1.0 Data de in\u00edcio: 19/10/21 Vis\u00e3o geral O C\u00f3digo Disciplinar do Servi\u00e7o P\u00fablico de Transporte de Passageiros por meio de \u00d4nibus do Munic\u00edpio do Rio de Janeiro (C\u00f3digo de Conduta do SPPO), institu\u00edda via decreto n\u00ba 36343 ), determina uma s\u00e9rie de condi\u00e7\u00f5es para a opera\u00e7\u00e3o, gest\u00e3o e qualidade das linhas municipais. Essas condi\u00e7\u00f5es, quando n\u00e3o cumprias, resultam em poss\u00edveis multas e outras san\u00e7\u00f5es. A partir de 2021, a SMTR passa a realizar o c\u00e1lculo de multas autom\u00e1ticas a partir da ferramenta desenvolvida de monitoramento por GPS, conforme resolu\u00e7\u00e3o n\u00ba 3413 . As multas aplicadas atrav\u00e9s da ferramenta podem ser aplicadas em 3 casos: Frota operante abaixo da determinada Falha no GPS ( n\u00e3o implementado ) N\u00e3o opera\u00e7\u00e3o da linha ( n\u00e3o implementado ) Para a vers\u00e3o 1.0 da ferramenta, consideramos somente infra\u00e7\u00f5es de frota operante abaixo da determinada em hor\u00e1rios de pico como pass\u00edveis de multa, com exce\u00e7\u00e3o de s\u00e1bados e domingos. Definic\u00f5es Cons\u00f3rcio : Empresa respons\u00e1vel pela opera\u00e7\u00e3o dos itiner\u00e1rios das linhas. Usualmente, cons\u00f3rcios operam linhas com exclusividade. Linha : Conjunto de servi\u00e7os, usualmente descrito por n\u00fameros, ex: 123, 720. Servi\u00e7o : Conjunto de itiner\u00e1rios, usualmente descrito pela linha e identificador do servi\u00e7o, ex: 123 RA, 720 PR. As linhas podem ter servi\u00e7os normais e espec\u00edficos (como 'Parador', 'Expresso', 'Noturno', etc). Itiner\u00e1rio : Trajetos executados por ve\u00edculos que param em pontos espec\u00edficos e tem frequ\u00eancia de sa\u00edda ou frota determinada. Frota determinada : N\u00famero de ve\u00edculos que dever\u00e3o operar em uma linha, definido pela SMTR. Frota operante : N\u00famero de ve\u00edculos distintos em operac\u00e3o que emitem um sinal de gps em determinada faixa hor\u00e1ria. Os ve\u00edculos considerados em operac\u00e3o s\u00e3o aqueles que (Art. 2 I da Resolu\u00e7\u00e3o): n\u00e3o est\u00e3o em garagens (veja a lista de garagens consideradas ); [N\u00c3O IMPLEMENTADO] tem o servi\u00e7o do gps associado ao mesmo trajeto que est\u00e1 sendo realizado no instante da emiss\u00e3o do sinal (ver documenta\u00e7\u00e3o da pipeline de gps); [N\u00c3O IMPLEMENTADO] n\u00e3o tiveram velocidade menor que 3km/h por mais que 10 minutos consecutivos. Faixa hor\u00e1ria : intervalo de 10 minutos comecando no primeiro minuto da hora, ex: 6:00, 6:10, 6:20. A faixa hor\u00e1ria ser\u00e1 desconsiderada caso ocorra mais que 2 falhas na captura dos dados de GPS pela SMTR. A captura \u00e9 executada a cada 1 minuto, portanto, espera-se 8 capturas a cada faixa hor\u00e1ria. Gravidade da multa (Art. 44) : As multas para atos oriundos diretamente do permission\u00e1rio/concession\u00e1rio classificam-se em quatro categorias, de acordo com sua gravidade (Tabela 1) Tipos de multa Frota operante abaixo da frota determinada O C\u00f3digo de Conduta do SPPO disp\u00f5e no Artigo 17.I sobre as condi\u00e7\u00f5es para aplicac\u00e3o de multas aos cons\u00f3ricios que operarem linhas abaixo da frota determinada. Defini\u00e7\u00e3o Segundo o C\u00f3digo de Conduta do SPPO no Artigo 17.I, as condic\u00f5es para aplicac\u00e3o da multa por frota operante abaixo da frota determinada s\u00e3o as seguintes: Se frota determinada <= 5, ent\u00e3o o cons\u00f3rcio estar\u00e1 sujeito a multa sempre que a frota operante for menor que a frota determina. Se frota determinada > 5, ent\u00e3o o cons\u00f3rcio estar\u00e1 sujeito a multa sempre que a frota operante for: < 80% da frota determinada, para dias \u00fateis [N\u00c3O CONSIDERADO] < 50% da frota determinada, para s\u00e1bados [N\u00c3O CONSIDERADO] < 40% da frota determinada, para domingos e feriados Regras espec\u00edficas para aplica\u00e7\u00e3o O C\u00f3digo de Conduta do SPPO n\u00e3o explicita como operacionalizar a aplicac\u00e3o das multas via gps. Portanto, a SMTR define junto \u00e0 Resolu\u00e7\u00e3o, um conjunto de regras quais s\u00e3o: Ser\u00e1 aplicada somente uma multa por pico da manh\u00e3 e da tarde (Art. 2 II). Ou seja, cada linha est\u00e1 sujeita a no m\u00e1ximo 2 multas por dia. Os hor\u00e1rios que determinam o pico s\u00e3o diferentes para cada cons\u00f3rcio dado a natureza de suas opera\u00e7\u00f5es (ver Tabela 1) A frota operante ser\u00e1 calculada para cada linha e faixa hor\u00e1ria. Se as condi\u00e7\u00f5es satisfizerem a defini\u00e7\u00e3o acima, ent\u00e3o a linha naquela faixa hor\u00e1ria ser\u00e1 considerada abaixo da frota determinada. As multas ser\u00e3o aplicadas para um pico se: existirem 3 faixas hor\u00e1rias (30 minutos) consecutivas abaixo da frota determinada existirem 8 faixas hor\u00e1rias (80 minutos) n\u00e3o consecutivas abaixo da frota determinada Falha no GPS (n\u00e3o implementado) Segundo o Art. 17 X do C\u00f3digo de Conduta do SPPO, as condic\u00f5es para aplicac\u00e3o da multa por falha de GPS s\u00e3o as seguintes: IX \u2013 Suspender por 24 (vinte e quatro) horas ou mais, sem autoriza\u00e7\u00e3o pr\u00e9via do \u00d3rg\u00e3o Gestor de transportes do Munic\u00edpio do Rio de Janeiro, a opera\u00e7\u00e3o do sistema de controle da linha atrav\u00e9s de GPS: Infra\u00e7\u00e3o \u2013 grav\u00edssima Penalidade \u2013 multa (Grupo E-1) X \u2013 Suspender por 1 (uma) hora ou mais, sem autoriza\u00e7\u00e3o pr\u00e9via do \u00d3rg\u00e3o Gestor de transportes do Munic\u00edpio do Rio de Janeiro, a opera\u00e7\u00e3o do sistema de controle da linha atrav\u00e9s de GPS: Infra\u00e7\u00e3o \u2013 grave Penalidade \u2013 multa (Grupo E-2) N\u00e3o opera\u00e7\u00e3o da linha (n\u00e3o implementado) Segundo o Art. 17 X do C\u00f3digo de Conduta do SPPO, as condic\u00f5es para aplicac\u00e3o da multa por falha de GPS s\u00e3o as seguintes: VII \u2013 Suspender por 24 (vinte e quatro) horas ou mais, sem autoriza\u00e7\u00e3o pr\u00e9via do \u00d3rg\u00e3o Gestor de Transportes do Munic\u00edpio do Rio de Janeiro, a opera\u00e7\u00e3o de uma linha ou servi\u00e7o, em um ou ambos os sentidos: Infra\u00e7\u00e3o \u2013 grav\u00edssima Penalidade \u2013 multa (Grupo E-1) VIII \u2013 Suspender por 4 (quatro) horas ou mais, sem autoriza\u00e7\u00e3o pr\u00e9via do \u00d3rg\u00e3o Gestor de Transportes do Munic\u00edpio do Rio de Janeiro, a opera\u00e7\u00e3o de uma linha ou servi\u00e7o, em um ou ambos os sentidos: Infra\u00e7\u00e3o \u2013 grav\u00edssima Penalidade \u2013 multa (Grupo E-1) Estrutura dos dados Para verifica\u00e7\u00e3o das multas s\u00e3o geradas 3 tabelas principais: Sum\u00e1rio de multas por linha ( sumario_multa_linha_onibus ) Detalhes de multa por linha ( detalhes_multa_linha_onibus ) Detalhes de multa por ve\u00edculos ( detalhes_multa_veiculo_onibus ) A documenta\u00e7\u00e3o completa da pipeline de captura, tratamento e atualiza\u00e7\u00e3o dos dados pode ser lida aqui . Tabelas e figuras de refer\u00eancia Tabela 1: Gravidade da multa Grupo Gravidade Valor Grupo E-1 Grav\u00edssima 520 (quinhentas e vinte) UFIR-RJ Grupo E-2 Grave 260 (duzentas e sessenta) UFIR-RJ Grupo E-3 M\u00e9dia 130 (cento e trinta) UFIR-RJ Grupo E-4 Leve 65 (sessenta e cinco) UFIR-RJ Tabela 2: Picos por cons\u00f3rcio (ajustado hor\u00e1rio de pico da manh\u00e3) Cons\u00f3rcio Pico Manh\u00e3 Pico Tarde Intersul 6:30 - 9:30 16:00 - 19:00 Internorte 6:00 - 9:00 16:00 - 19:00 Transcarioca 6:00 - 9:00 16:00 - 19:00 Santa Cruz 5:30 - 8:30 17:00 - 20:00","title":"Multas Autom\u00e1ticas"},{"location":"pipelines/multas-automaticas/#multas-automaticas-metodologia","text":"Vers\u00e3o: v1.0 Data de in\u00edcio: 19/10/21","title":"Multas Autom\u00e1ticas - Metodologia"},{"location":"pipelines/multas-automaticas/#visao-geral","text":"O C\u00f3digo Disciplinar do Servi\u00e7o P\u00fablico de Transporte de Passageiros por meio de \u00d4nibus do Munic\u00edpio do Rio de Janeiro (C\u00f3digo de Conduta do SPPO), institu\u00edda via decreto n\u00ba 36343 ), determina uma s\u00e9rie de condi\u00e7\u00f5es para a opera\u00e7\u00e3o, gest\u00e3o e qualidade das linhas municipais. Essas condi\u00e7\u00f5es, quando n\u00e3o cumprias, resultam em poss\u00edveis multas e outras san\u00e7\u00f5es. A partir de 2021, a SMTR passa a realizar o c\u00e1lculo de multas autom\u00e1ticas a partir da ferramenta desenvolvida de monitoramento por GPS, conforme resolu\u00e7\u00e3o n\u00ba 3413 . As multas aplicadas atrav\u00e9s da ferramenta podem ser aplicadas em 3 casos: Frota operante abaixo da determinada Falha no GPS ( n\u00e3o implementado ) N\u00e3o opera\u00e7\u00e3o da linha ( n\u00e3o implementado ) Para a vers\u00e3o 1.0 da ferramenta, consideramos somente infra\u00e7\u00f5es de frota operante abaixo da determinada em hor\u00e1rios de pico como pass\u00edveis de multa, com exce\u00e7\u00e3o de s\u00e1bados e domingos.","title":"Vis\u00e3o geral"},{"location":"pipelines/multas-automaticas/#definicoes","text":"Cons\u00f3rcio : Empresa respons\u00e1vel pela opera\u00e7\u00e3o dos itiner\u00e1rios das linhas. Usualmente, cons\u00f3rcios operam linhas com exclusividade. Linha : Conjunto de servi\u00e7os, usualmente descrito por n\u00fameros, ex: 123, 720. Servi\u00e7o : Conjunto de itiner\u00e1rios, usualmente descrito pela linha e identificador do servi\u00e7o, ex: 123 RA, 720 PR. As linhas podem ter servi\u00e7os normais e espec\u00edficos (como 'Parador', 'Expresso', 'Noturno', etc). Itiner\u00e1rio : Trajetos executados por ve\u00edculos que param em pontos espec\u00edficos e tem frequ\u00eancia de sa\u00edda ou frota determinada. Frota determinada : N\u00famero de ve\u00edculos que dever\u00e3o operar em uma linha, definido pela SMTR. Frota operante : N\u00famero de ve\u00edculos distintos em operac\u00e3o que emitem um sinal de gps em determinada faixa hor\u00e1ria. Os ve\u00edculos considerados em operac\u00e3o s\u00e3o aqueles que (Art. 2 I da Resolu\u00e7\u00e3o): n\u00e3o est\u00e3o em garagens (veja a lista de garagens consideradas ); [N\u00c3O IMPLEMENTADO] tem o servi\u00e7o do gps associado ao mesmo trajeto que est\u00e1 sendo realizado no instante da emiss\u00e3o do sinal (ver documenta\u00e7\u00e3o da pipeline de gps); [N\u00c3O IMPLEMENTADO] n\u00e3o tiveram velocidade menor que 3km/h por mais que 10 minutos consecutivos. Faixa hor\u00e1ria : intervalo de 10 minutos comecando no primeiro minuto da hora, ex: 6:00, 6:10, 6:20. A faixa hor\u00e1ria ser\u00e1 desconsiderada caso ocorra mais que 2 falhas na captura dos dados de GPS pela SMTR. A captura \u00e9 executada a cada 1 minuto, portanto, espera-se 8 capturas a cada faixa hor\u00e1ria. Gravidade da multa (Art. 44) : As multas para atos oriundos diretamente do permission\u00e1rio/concession\u00e1rio classificam-se em quatro categorias, de acordo com sua gravidade (Tabela 1)","title":"Definic\u00f5es"},{"location":"pipelines/multas-automaticas/#tipos-de-multa","text":"","title":"Tipos de multa"},{"location":"pipelines/multas-automaticas/#frota-operante-abaixo-da-frota-determinada","text":"O C\u00f3digo de Conduta do SPPO disp\u00f5e no Artigo 17.I sobre as condi\u00e7\u00f5es para aplicac\u00e3o de multas aos cons\u00f3ricios que operarem linhas abaixo da frota determinada.","title":"Frota operante abaixo da frota determinada"},{"location":"pipelines/multas-automaticas/#definicao","text":"Segundo o C\u00f3digo de Conduta do SPPO no Artigo 17.I, as condic\u00f5es para aplicac\u00e3o da multa por frota operante abaixo da frota determinada s\u00e3o as seguintes: Se frota determinada <= 5, ent\u00e3o o cons\u00f3rcio estar\u00e1 sujeito a multa sempre que a frota operante for menor que a frota determina. Se frota determinada > 5, ent\u00e3o o cons\u00f3rcio estar\u00e1 sujeito a multa sempre que a frota operante for: < 80% da frota determinada, para dias \u00fateis [N\u00c3O CONSIDERADO] < 50% da frota determinada, para s\u00e1bados [N\u00c3O CONSIDERADO] < 40% da frota determinada, para domingos e feriados","title":"Defini\u00e7\u00e3o"},{"location":"pipelines/multas-automaticas/#regras-especificas-para-aplicacao","text":"O C\u00f3digo de Conduta do SPPO n\u00e3o explicita como operacionalizar a aplicac\u00e3o das multas via gps. Portanto, a SMTR define junto \u00e0 Resolu\u00e7\u00e3o, um conjunto de regras quais s\u00e3o: Ser\u00e1 aplicada somente uma multa por pico da manh\u00e3 e da tarde (Art. 2 II). Ou seja, cada linha est\u00e1 sujeita a no m\u00e1ximo 2 multas por dia. Os hor\u00e1rios que determinam o pico s\u00e3o diferentes para cada cons\u00f3rcio dado a natureza de suas opera\u00e7\u00f5es (ver Tabela 1) A frota operante ser\u00e1 calculada para cada linha e faixa hor\u00e1ria. Se as condi\u00e7\u00f5es satisfizerem a defini\u00e7\u00e3o acima, ent\u00e3o a linha naquela faixa hor\u00e1ria ser\u00e1 considerada abaixo da frota determinada. As multas ser\u00e3o aplicadas para um pico se: existirem 3 faixas hor\u00e1rias (30 minutos) consecutivas abaixo da frota determinada existirem 8 faixas hor\u00e1rias (80 minutos) n\u00e3o consecutivas abaixo da frota determinada","title":"Regras espec\u00edficas para aplica\u00e7\u00e3o"},{"location":"pipelines/multas-automaticas/#falha-no-gps-nao-implementado","text":"Segundo o Art. 17 X do C\u00f3digo de Conduta do SPPO, as condic\u00f5es para aplicac\u00e3o da multa por falha de GPS s\u00e3o as seguintes: IX \u2013 Suspender por 24 (vinte e quatro) horas ou mais, sem autoriza\u00e7\u00e3o pr\u00e9via do \u00d3rg\u00e3o Gestor de transportes do Munic\u00edpio do Rio de Janeiro, a opera\u00e7\u00e3o do sistema de controle da linha atrav\u00e9s de GPS: Infra\u00e7\u00e3o \u2013 grav\u00edssima Penalidade \u2013 multa (Grupo E-1) X \u2013 Suspender por 1 (uma) hora ou mais, sem autoriza\u00e7\u00e3o pr\u00e9via do \u00d3rg\u00e3o Gestor de transportes do Munic\u00edpio do Rio de Janeiro, a opera\u00e7\u00e3o do sistema de controle da linha atrav\u00e9s de GPS: Infra\u00e7\u00e3o \u2013 grave Penalidade \u2013 multa (Grupo E-2)","title":"Falha no GPS (n\u00e3o implementado)"},{"location":"pipelines/multas-automaticas/#nao-operacao-da-linha-nao-implementado","text":"Segundo o Art. 17 X do C\u00f3digo de Conduta do SPPO, as condic\u00f5es para aplicac\u00e3o da multa por falha de GPS s\u00e3o as seguintes: VII \u2013 Suspender por 24 (vinte e quatro) horas ou mais, sem autoriza\u00e7\u00e3o pr\u00e9via do \u00d3rg\u00e3o Gestor de Transportes do Munic\u00edpio do Rio de Janeiro, a opera\u00e7\u00e3o de uma linha ou servi\u00e7o, em um ou ambos os sentidos: Infra\u00e7\u00e3o \u2013 grav\u00edssima Penalidade \u2013 multa (Grupo E-1) VIII \u2013 Suspender por 4 (quatro) horas ou mais, sem autoriza\u00e7\u00e3o pr\u00e9via do \u00d3rg\u00e3o Gestor de Transportes do Munic\u00edpio do Rio de Janeiro, a opera\u00e7\u00e3o de uma linha ou servi\u00e7o, em um ou ambos os sentidos: Infra\u00e7\u00e3o \u2013 grav\u00edssima Penalidade \u2013 multa (Grupo E-1)","title":"N\u00e3o opera\u00e7\u00e3o da linha (n\u00e3o implementado)"},{"location":"pipelines/multas-automaticas/#estrutura-dos-dados","text":"Para verifica\u00e7\u00e3o das multas s\u00e3o geradas 3 tabelas principais: Sum\u00e1rio de multas por linha ( sumario_multa_linha_onibus ) Detalhes de multa por linha ( detalhes_multa_linha_onibus ) Detalhes de multa por ve\u00edculos ( detalhes_multa_veiculo_onibus ) A documenta\u00e7\u00e3o completa da pipeline de captura, tratamento e atualiza\u00e7\u00e3o dos dados pode ser lida aqui .","title":"Estrutura dos dados"},{"location":"pipelines/multas-automaticas/#tabelas-e-figuras-de-referencia","text":"Tabela 1: Gravidade da multa Grupo Gravidade Valor Grupo E-1 Grav\u00edssima 520 (quinhentas e vinte) UFIR-RJ Grupo E-2 Grave 260 (duzentas e sessenta) UFIR-RJ Grupo E-3 M\u00e9dia 130 (cento e trinta) UFIR-RJ Grupo E-4 Leve 65 (sessenta e cinco) UFIR-RJ Tabela 2: Picos por cons\u00f3rcio (ajustado hor\u00e1rio de pico da manh\u00e3) Cons\u00f3rcio Pico Manh\u00e3 Pico Tarde Intersul 6:30 - 9:30 16:00 - 19:00 Internorte 6:00 - 9:00 16:00 - 19:00 Transcarioca 6:00 - 9:00 16:00 - 19:00 Santa Cruz 5:30 - 8:30 17:00 - 20:00","title":"Tabelas e figuras de refer\u00eancia"}]}